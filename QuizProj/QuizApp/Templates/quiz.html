
<!--(1)-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QuizAPP-ByPujar</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
</head>

<body class="p-4 bg-light">
  <div id="app" class="container">
    <h2 class="mb-4">Give Quiz (Category: [[ category ]])</h2> <!--(3) Fetching the category ofthe quiz-->

    <!-- Loading message -->
    <div v-if="questions.length === 0">
      <p>Loading quiz questions...</p>
    </div>

    <!-- Quiz questions -->
    <div v-else>
      <div v-for="(question, qIndex) in questions" :key="question.uid" class="mb-4 card p-3 shadow-sm">
        <h5>[[ qIndex + 1 ]]. [[ question.question ]]</h5>

        <div v-for="(ans, aIndex) in question.answer" :key="aIndex" class="form-check mt-2">
          <input
            class="form-check-input"
            type="radio"
            :name="'question_' + qIndex"
            :value="ans.answer"
            @change="checkAnswer($event, question.uid)">
          <label class="form-check-label">
            [[ ans.answer ]]
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Vue.js -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>

  <script>
    var app = new Vue({
      el: '#app',
      delimiters: ['[[', ']]'],
      data() {
        return {
          category: '{{ category|default:"Fullstack" }}', 
          questions: [] 
        }
      },
      methods: {
        getQuestions() {
          const url = `/api/get-quiz/?category=${this.category}`;
          console.log("Fetching quiz from:", url);

          fetch(url)
            .then(res => res.json())
            .then(result => {
              console.log("API result:", result);
              if (result.status && Array.isArray(result.data)) {
                this.questions = result.data;
              } else {
                console.error("Unexpected API format:", result);
              }
            })
            .catch(err => console.error("Fetch error:", err));
        },

        checkAnswer(event, uid) {
          const selected = event.target.value;
          const question = this.questions.find(q => q.uid === uid);
          if (!question) return;

          const answerObj = question.answer.find(a => a.answer === selected);
          if (!answerObj) return;

          if (answerObj.is_correct) {
            alert("✅ Correct! Your answer is right.");
          } else {
            alert("❌ Incorrect! Try again.");
          }
        }
      },
      created() {
        console.log("Vue app loaded, calling getQuestions()");
        this.getQuestions();
      }
    });
  </script>
</body>
</html>